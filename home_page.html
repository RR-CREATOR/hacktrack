<!DOCTYPE html> 
<html>
<head>
	<title>name</title>
<script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>

<link href="https://fonts.googleapis.com/css?family=Yeon+Sung&display=swap" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

<link rel="stylesheet" type="text/css" href="style.css">
<script src="try.js"></script>
</head>
<body>
<button id="logout" class="glyphicon glyphicon-log-out btn btn-danger" onclick="logout();">Logout</button>
<div class="container">
	<center>
		<h1 class="header">	
			QUESTIONS	
		</h1>
		<h3 id="user_name" class="color_white"></h3>
		<div class="form-group input_div_room_page">
			<label style="margin-bottom: 6px;">Add Question:</label>
			<input type="text" id="room_name" class="form-control" placeholder="Question Title">
		</div>
		<br>
		<button id="roomButton" class="btn btn-success">Create</button>
		<h3 class="color_white">#Questions</h3>
	<div id="output"></div>
	</center>
</div>
<div class="copy_right_footer"><p>Note: Click on the title of the question to open it.</p></div>
<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.3.0/firebase-app.js";
	// TODO: Add SDKs for Firebase products that you want to use
	// https://firebase.google.com/docs/web/setup#available-libraries
  
	// Your web app's Firebase configuration
	const firebaseConfig = {
	  apiKey: "AIzaSyCiCjNo7h8SBeIpy54_x5Fp9K4u2rYU68o",
	  authDomain: "repcard-68a86.firebaseapp.com",
	  projectId: "repcard-68a86",
	  storageBucket: "repcard-68a86.appspot.com",
	  messagingSenderId: "268606048540",
	  appId: "1:268606048540:web:9fc7a08a01bc124f2e92d9"
	};
  
	// Initialize Firebase
	const app = initializeApp(firebaseConfig);

	import{
		getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField, getDocs
	}
	from "https://www.gstatic.com/firebasejs/9.3.0/firebase-firestore.js";

	const db = getFirestore();

	//CODE MAIN//

	var user_name = localStorage.getItem("userName");
	document.getElementById("user_name").innerHTML = "Welcome " + user_name + "!";

	let repBox = document.getElementById("room_name");
	let addBtn = document.getElementById("roomButton");

	let logBtn = document.getElementById("logout");
	let output = document.getElementById("output");

	var row="";
	var repName;
	var roomNames = [];

	const querySnapshot = await getDocs(collection(db, "questions"));
    querySnapshot.forEach((doc) => {
    roomNames.push(doc.id);
});

var numberRooms = roomNames.length;

console.log(roomNames);
console.log(numberRooms);
var i = 0;
for (i; i < numberRooms; i++){
			console.log(i);
	row = "<div class='room_name' id='" + roomNames[i] + "' onclick='redirectToRoomName(this.id)'>" + roomNames[i] + "</div><hr>";
	document.getElementById("output").innerHTML += row;
}

	async function logout(){
		localStorage.removeItem("userName");
		localStorage.removeItem("OpenedRep")
		window.location = "index.html";
	}

	async function addRoom(){
		var ref = doc(db, "questions", repBox.value);

	const docRef = await setDoc(
		ref, {
			RepCardName: repBox.value,
			dataAdded: false,
			askedBy: user_name
		}
	)

	.then(()=>{
		GetName();
	})
	.catch((error)=>{
		alert("Unsuccessful, error: " + error);
	})
	}

	async function GetName(){
		var ref = doc(db, "questions", repBox.value);

		const docSnap = await getDoc(ref);
		repName = docSnap.data().RepCardName;

		if(docSnap.exists()){
			roomCreate();
		}
	}

	async function roomCreate(){
	row = "<div class='room_name' id=" + repName + " onclick='redirectToRoomName(this.id)' >" + repName + "</div><hr>";
	document.getElementById("output").innerHTML += row;
	repBox.value = "";
	}

	addBtn.addEventListener("click", addRoom);
	logBtn.addEventListener("click", logout);


	</script>
</body>
</html>